#include "file1.h" //???????? ?????????? ? TRec*
#include <iostream> // header in standard library
#include <stdio.h>
#define _CRT_SECURE_NO_WARNINGS
void ShowData(BookStore *data, unsigned &count);

eCMD MenuShow()
{
	while (true)
	{
		puts("\nВыберите  : ");
		puts(" 1 - Редактировать запись"); //??????????? ????
		puts(" 2 - Добавить запись"); //??????????? ????
		puts(" 3 - Удалить запись");
		puts(" 6 - Назад"); //??????????? ????
		unsigned opt;
		fflush(stdin); //????????? ???????? ??????
		scanf_s("%u" , &opt);
		switch (opt) { //??????? ?? ??????? ???????
			case 1: return CMD_EDIT;
			case 2: return CMD_ADD;
			case 3: return CMD_DELETE;
			case 6: return CMD_EXIT;
			default: puts("?? ????? ???????????? ??????? ");
				system("pause");
		}
	}
}

void EditRecord(BookStore *data, unsigned count)
{
	std::cout << "Global data address" << data << "\n";
	puts("\n???????? ??????,??????? ?????? ????????: ");
	unsigned opt;
	while (true) {
		fflush(stdin); //????????? ???????? ??????
		scanf_s("%u", &opt);
		if (opt < count) {
			break;
		}
		else {
			puts("?????? ???????? ????? ??????,?????????? ??? ???: ");
		}
	}
	/*BookStore myBuffer;
	BookStore *pbuffer;
	pbuffer = &myBuffer;*/
	printf("???????? ???? ????? - %s, ??????? ????? ????????:",data[opt].author);
	fflush(stdin); //????????? ???????? ??????
	scanf("%s", &data[opt].author);

	printf("???????? ???? ???????? ????? - %s, ??????? ????? ????????:", data[opt].bookName);
	fflush(stdin); //????????? ???????? ??????
	scanf("%s", &data[opt].bookName);

	printf("???????? ???? ??? - %s, ??????? ????? ????????:", data[opt].code);
	fflush(stdin); //????????? ???????? ??????
	scanf("%s", &data[opt].code);

    // ???????? ???????? ????????
	printf("???????? ???? ???? - %f, ??????? ????? ????????:", data[opt].price);
	fflush(stdin); //????????? ???????? ??????
	scanf("%f", &data[opt].price);

	printf("???????? ???? ?????????? - %d, ??????? ????? ????????:", data[opt].count);
	fflush(stdin); //????????? ???????? ??????
	scanf("%d", &data[opt].count);
	printf("______________________________________________________________________\n");
	printf("|%d|%16s|%16s|%16s|%4f ???.|%3i ??.|\n",
		opt,
		data[opt].author,
		data[opt].bookName,
		data[opt].code,
		data[opt].price,
		data[opt].count);
	system("pause");
	//ShowData(data, count);

}

void AddRecord(BookStore *data, unsigned *count)
{
	std::cout << "Global data address" << data << "\n";
	std::cout << "Global count address" << count << "\n";
	std::cout << "Global count value" << *count << "\n";
	if (*count < MAX_SIZE) {
		unsigned opt = *count;
		std::cout << "opt value" << opt << "\n";
		*count += 1;
		puts("Введите значение 1");
		fflush(stdin); //????????? ???????? ??????
		scanf("%s", &data[opt].author);

		puts("Введите значение 2");
		fflush(stdin); //????????? ???????? ??????
		scanf("%s", &data[opt].bookName);

		puts("Введите значение 3");
		fflush(stdin); //????????? ???????? ??????
		scanf("%s", &data[opt].code);

		// ???????? ???????? ????????
		puts("Введите значение 4");
		fflush(stdin); //????????? ???????? ??????
		scanf("%f", &data[opt].price);

		puts("Введите значение 5");
		fflush(stdin); //????????? ???????? ??????
		scanf("%d", &data[opt].count);
		printf("______________________________________________________________________\n");
		printf("|%d|%16s|%16s|%16s|%4f ???.|%3i ??.|\n",
			opt,
			data[opt].author,
			data[opt].bookName,
			data[opt].code,
			data[opt].price,
			data[opt].count);
		std::cout << "Global data address" << data << "\n";
		std::cout << "Global count address" << &count << "\n";
		std::cout << "Global count value" << count << "\n";
		system("pause");
	}
	else {
		puts("Достигнут максимум записей");
		
	}
}

void DeleteRecord(BookStore *data, unsigned *count) {
	std::cout << "Global data address" << data << "\n";
	std::cout << "Global count address" << count << "\n";
	std::cout << "Global count value" << *count << "\n";
	printf("Какую запись Вы хотите удалить? ");
	unsigned opt;
	fflush(stdin); 
	scanf("%u", &opt);
	if (*count > opt) {
		for (unsigned i = opt; i < *count; i++)
		{
			data[i] = data[i + 1];
		}
		*count -= 1;
	}
	else {
		puts("Неверно введен номер записи для удаления!");
	}
}

void ShowData(BookStore *data, unsigned &count) 
{

	eCMD cmd = CMD_NONE;
	while (cmd != CMD_EXIT)
	{
		system("cls");
		std::cout << "Global data address" << data << "\n";
		std::cout << "Global count address" << &count << "\n";
		std::cout << "Global count value" << count << "\n";
		printf("___________________________________________________________________\n");
		printf("|id|%16s|%16s|%16s|     ???.|     ??.|\n",
			"?????",
			"?????",
			"???");
		for (unsigned i = 0; i < count; i++) {
			printf("______________________________________________________________________\n");
			printf("|%d|%16s|%16s|%16s|%4f ???.|%3i ??.|\n", 
					i,
					data[i].author,
					data[i].bookName,
					data[i].code,
					data[i].price,
					data[i].count);
		}
		cmd = MenuShow(); //??????????? ???? ? ???? ??????
		switch (cmd) //????? ??????? ??? ??????????????? ???????
		{
		case CMD_EDIT: 
			EditRecord(data, count);
			break;
		case CMD_ADD:
			AddRecord(data, &count);
			break;
		case CMD_DELETE:
			DeleteRecord(data, &count);
			break;
		}
	}
	puts("done");
	system("pause");
}

